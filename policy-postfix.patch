--- policy-1.4.15/domains/program/unused/postfix.te.orig	Mon Feb  9 10:42:03 2004
+++ policy-1.4.15/domains/program/unused/postfix.te	Wed Feb 18 11:11:37 2004
@@ -19,6 +19,7 @@
 
 # postfix needs this for newaliases
 allow { system_mail_t sysadm_mail_t } tmp_t:dir getattr;
+allow { system_mail_t sysadm_mail_t } etc_postfix_t:file rw_file_perms;
 
 #################################
 #
@@ -27,7 +28,7 @@
 # postfix_$1_exec_t is the type of the postfix_$1 executables.
 #
 define(`postfix_domain', `
-daemon_base_domain(postfix_$1, `$2')
+daemon_base_domain(postfix_$1, `$2', `nosysadm')
 allow postfix_$1_t self:process setpgid;
 allow postfix_$1_t postfix_master_t:process sigchld;
 allow postfix_master_t postfix_$1_t:process signal;
@@ -272,3 +273,29 @@
 ifdef(`procmail.te', `
 domain_auto_trans(postfix_pipe_t, procmail_exec_t, procmail_t)
 ')
+
+# postsuper (incl. -d) for sysadm
+postfix_user_domain(postsuper)
+can_exec(postfix_master_t, postfix_postsuper_exec_t)
+domain_auto_trans(sysadm_t, postfix_postsuper_exec_t, postfix_postsuper_t)
+allow postfix_postsuper_t postfix_spool_t:dir rw_dir_perms;
+allow postfix_postsuper_t postfix_spool_t:file { unlink rename getattr };
+allow postfix_postsuper_t postfix_spool_bounce_t:dir rw_dir_perms;
+allow postfix_postsuper_t postfix_spool_bounce_t:file { unlink rename getattr };
+allow postfix_postsuper_t postfix_spool_maildrop_t:dir rw_dir_perms;
+allow postfix_postsuper_t postfix_spool_maildrop_t:file { unlink rename getattr };
+allow postfix_postsuper_t sysadm_devpts_t:chr_file { read write getattr };
+allow postfix_postsuper_t self:capability { setgid setuid };
+
+# because of IPv6 patch using getifaddrs(), which uses netlink
+allow { postfix_bounce_t postfix_cleanup_t postfix_local_t postfix_master_t postfix_pickup_t postfix_postdrop_t postfix_postqueue_t postfix_postsuper_t postfix_qmgr_t postfix_showq_t postfix_smtp_t postfix_smtpd_t } self:netlink_socket { create bind read write };
+allow { postfix_bounce_t postfix_cleanup_t postfix_local_t postfix_master_t postfix_pickup_t postfix_postdrop_t postfix_postqueue_t postfix_postsuper_t postfix_qmgr_t postfix_showq_t postfix_smtp_t postfix_smtpd_t } self:capability { net_admin };
+
+allow postfix_master_t sysadm_devpts_t:chr_file { read write getattr };
+
+# allow mailq
+allow { system_mail_t sysadm_mail_t staff_mail_t } self:netlink_socket { create bind read write };
+allow { system_mail_t sysadm_mail_t staff_mail_t } self:capability { net_admin };
+
+# maybe this should be applied for mta_delivery_agent in general?
+rw_dir_create_file(postfix_local_t, mail_spool_t)
--- policy-1.4.15/file_contexts/program/postfix.fc.orig	Wed Nov 19 21:15:25 2003
+++ policy-1.4.15/file_contexts/program/postfix.fc	Wed Feb 18 11:07:58 2004
@@ -1,7 +1,7 @@
 # postfix
-/etc/postfix(/.*)?		system_u:object_r:etc_postfix_t
-/etc/postfix/postfix-script.* -- system_u:object_r:postfix_exec_t
-/etc/postfix/prng_exch	--	system_u:object_r:postfix_prng_t
+/etc/mail(/.*)?		system_u:object_r:etc_postfix_t
+/etc/mail/postfix-script.* -- system_u:object_r:postfix_exec_t
+/etc/mail/prng_exch	--	system_u:object_r:postfix_prng_t
 /usr/lib(64)?/postfix/.*	--	system_u:object_r:postfix_exec_t
 /usr/lib(64)?/postfix/cleanup --	system_u:object_r:postfix_cleanup_exec_t
 /usr/lib(64)?/postfix/local	--	system_u:object_r:postfix_local_exec_t
@@ -23,7 +23,7 @@
 /usr/sbin/postlog	--	system_u:object_r:postfix_master_exec_t
 /usr/sbin/postmap	--	system_u:object_r:postfix_master_exec_t
 /usr/sbin/postqueue	--	system_u:object_r:postfix_postqueue_exec_t
-/usr/sbin/postsuper	--	system_u:object_r:postfix_master_exec_t
+/usr/sbin/postsuper	--	system_u:object_r:postfix_postsuper_exec_t
 /usr/sbin/rmail		--	system_u:object_r:sendmail_exec_t
 /var/spool/postfix(/[^/]+)?	system_u:object_r:postfix_spool_t
 /var/spool/postfix/active(/.*)?	system_u:object_r:postfix_spool_t
